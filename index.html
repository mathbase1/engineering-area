<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Civil Engineering – Scaling & Proportion Worksheet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root{
      --accent:#6a5cff;         /* vibrant indigo */
      --accent2:#00c2ff;        /* aqua */
      --light:#eef3ff;
      --ink:#0f172a;
      --muted:#55607a;
      --success:#2e7d32;
      --error:#e53935;
      --surface:#ffffff;
      --field-w:11rem;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,sans-serif;
      margin:0;color:var(--ink);
      background:
        radial-gradient(1200px 600px at 10% -10%, #dfe8ff, transparent 60%),
        radial-gradient(1200px 600px at 110% 10%, #ccfbff, transparent 60%),
        linear-gradient(180deg,#f5f8ff 0%, #f0fbff 50%, #eef3ff 100%);
    }
    h1{
      margin:0.7rem 0 0.4rem;text-align:center;
      font-size:1.6rem;font-weight:900;
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      -webkit-background-clip:text;background-clip:text;color:transparent;
      letter-spacing:.2px
    }
    p.lede{max-width:980px;margin:0.2rem auto 0.6rem;text-align:center;color:#1f2a44}

    .logo{position:absolute;top:10px;left:10px;width:110px;height:auto;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.15)}

    /* Top bar */
    .topbar{
      max-width:980px;margin:0.15rem auto 0.65rem;display:flex;gap:0.6rem;
      justify-content:space-between;align-items:center;padding:0 0.6rem
    }
    .badge{
      background:#fff;border:1px solid rgba(106,92,255,.25);border-radius:14px;
      padding:0.5rem 0.7rem;font-weight:800;min-width:120px;text-align:center;
      box-shadow:0 3px 10px rgba(106,92,255,.08)
    }
    .badge small{display:block;font-weight:600;color:var(--muted);margin-top:2px;font-size:.82rem}
    .top-actions{display:flex;gap:0.45rem;align-items:center}
    .fsBtn{
      border:1px solid rgba(0,194,255,.5);background:linear-gradient(180deg,#ffffff,#f3fcff);
      border-radius:12px;padding:.55rem .8rem;font-weight:900;cursor:pointer;color:#0b3d4a;
      box-shadow:0 3px 10px rgba(0,194,255,.15)
    }
    .fsBtn:hover{background:#ecfbff}

    /* Card */
    .card{
      max-width:980px;margin:0.25rem auto;background:var(--surface);border-radius:16px;
      border:2px solid rgba(106,92,255,.35);
      box-shadow:0 12px 30px rgba(106,92,255,.12), 0 6px 14px rgba(0,0,0,.06);
      padding:0.95rem
    }
    .titleRow{display:flex;justify-content:space-between;align-items:flex-start;gap:1rem}
    .qTitle{font-size:1.15rem;font-weight:900;color:#2c3477;margin:0.1rem 0}
    .qMeta{color:var(--muted);font-size:.95rem}

    .statement{font-size:1rem;margin:0.55rem 0 0.7rem}
    details{border:1px solid rgba(106,92,255,.3);border-radius:12px;margin:0.5rem 0;background:#fbfcff}
    summary{cursor:pointer;font-weight:900;color:#2c3477;padding:0.6rem 0.8rem;list-style:none}
    summary::-webkit-details-marker{display:none}
    .hint{padding:0 0.9rem 0.85rem;font-size:.95rem;color:#1f2a44}
    .hint ul{margin:0.35rem 0 0.25rem 1.2rem}
    .hint code{background:#f1f4ff;padding:2px 6px;border-radius:6px;border:1px solid rgba(106,92,255,.25)}
    .hint strong{color:#1a2b7a}

    /* Inputs */
    .io{display:grid;gap:0.8rem;margin-top:0.5rem}
    .row{display:grid;grid-template-columns:1.2fr auto auto auto 1fr;align-items:center;gap:.5rem}
    .row label{font-weight:900;color:#1f2a44}
    .unit{
      background:linear-gradient(180deg,#eef4ff,#f7fbff);
      border:1px solid rgba(0,194,255,.35);
      color:#173a56;border-radius:10px;padding:0.35rem 0.6rem;font-weight:900;min-width:6.5rem;text-align:center
    }
    .num{
      width:var(--field-w);text-align:center;border:1px solid rgba(106,92,255,.45);
      border-radius:10px;font-size:1.02rem;padding:.48rem .4rem;background:linear-gradient(180deg,#ffffff,#f6f7ff);
      box-shadow:inset 0 1px 2px rgba(0,0,0,.06)
    }
    .num:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(106,92,255,.18)}

    /* Markers & feedback */
    .marker{font-size:1.45rem;font-weight:900;min-width:1.9rem;text-align:center}
    .ok{color:var(--success); animation:pop .25s ease-out}
    .no{color:var(--error)}
    @keyframes pop { 0%{transform:scale(0.85)} 100%{transform:scale(1)} }
    .feedback{font-size:0.95rem;color:#1f2a44}
    .feedback .ans{font-weight:900}

    /* Controls */
    .controls{display:flex;justify-content:center;gap:.6rem;margin-top:0.75rem;flex-wrap:wrap}
    button.primary{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#fff;border:none;border-radius:12px;padding:.7rem 1.2rem;font-weight:900;cursor:pointer;
      box-shadow:0 8px 18px rgba(106,92,255,.25)
    }
    button.secondary{
      background:#111827;color:#fff;border:none;border-radius:12px;padding:.7rem 1.2rem;font-weight:900;cursor:pointer
    }
    button.ghost{
      background:linear-gradient(180deg,#ffffff,#f7f9ff);border:1px solid rgba(17,24,39,.25);
      border-radius:12px;padding:.6rem 1rem;font-weight:900;cursor:pointer;color:#111827
    }
    button:disabled{opacity:.6;cursor:not-allowed}
    #progress{font-weight:900;text-align:center;color:#111827;margin:0.15rem 0 0.6rem}

    /* Start modal */
    .modal{position:fixed;inset:0;background:rgba(15,23,42,.35);display:flex;align-items:center;justify-content:center;padding:1rem;z-index:999}
    .panel{
      background:linear-gradient(180deg,#ffffff,#f7f8ff);
      border-radius:16px;max-width:780px;width:100%;
      box-shadow:0 18px 40px rgba(17,24,39,.25);border:2px solid rgba(106,92,255,.35)
    }
    .panel header{padding:0.9rem 1rem;border-bottom:1px solid rgba(106,92,255,.25)}
    .panel header h2{margin:0;color:#2c3477}
    .panel .content{padding:1rem;display:grid;gap:0.9rem}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:0.8rem}
    .field{display:grid;gap:0.35rem}
    .field input[type=text], .field input[type=number], .field select{
      padding:0.55rem .6rem;border:1px solid rgba(106,92,255,.4);border-radius:10px;background:#fff
    }
    .choiceRow{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
    .pill{border:1px solid rgba(106,92,255,.45);padding:.35rem .7rem;border-radius:999px;cursor:pointer;font-weight:900;background:#fff}
    .pill input{margin-right:.35rem}
    .panel footer{display:flex;justify-content:space-between;align-items:center;padding:0.85rem 1rem;border-top:1px solid rgba(106,92,255,.25)}
    .muted{color:var(--muted);font-size:.95rem}

    /* End screen */
    #endCard{max-width:820px;margin:1rem auto;padding:1rem;border-radius:14px;background:#fff;border:2px solid #2e7d32;display:none}
    #endCard h3{margin-top:0;color:#1e7a31}
    .wellDone{display:inline-block;background:#eaf7ec;border:1px solid #b9e2bf;color:#1e7a31;padding:.25rem .5rem;border-radius:8px;font-weight:900}

    /* Figures (SVG) */
    .fig{max-width:520px;width:100%;height:auto;display:block;margin:.4rem auto;border-radius:12px;box-shadow:0 8px 20px rgba(0,0,0,.08);background:#fff}

    /* Error banner */
    #errBanner{display:none;position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
      background:#fee;border:2px solid #e53935;color:#7f1d1d;padding:.5rem .8rem;border-radius:10px;font-weight:800;z-index:2000}

    /* Small screens / short viewports */
    @media (max-width:680px){
      .row{grid-template-columns:1fr auto auto auto 1fr}
      .grid2{grid-template-columns:1fr}
      .num{width:8.8rem}
      .logo{width:88px}
    }
    @media (max-height:740px){
      body{font-size:0.97rem}
      .qTitle{font-size:1.07rem}
      .num{padding:.38rem .34rem}
      .card{padding:0.8rem}
      .topbar{gap:0.45rem}
      .badge{padding:0.4rem 0.6rem}
    }
  </style>
</head>
<body>
  <img src="https://lirp.cdn-website.com/b085c470/dms3rep/multi/opt/Bucks%2BCollege%2BGroup-e5af1b68-1920w.jpg"
       alt="Bucks College Group logo" class="logo">

  <h1>Areas &amp; Compound Shapes – Civil Engineering</h1>
  <p class="lede">Find areas of rectangles, triangles, circles &amp; compound shapes in realistic site/design settings. <strong>Use π = 3.142</strong> for all circular parts and <strong>enter answers to 2 dp</strong>.</p>

  <div class="topbar">
    <div style="display:flex;gap:0.6rem;align-items:center">
      <div class="badge" id="who"><span id="whoName">Student</span><small>Participant</small></div>
      <div class="badge" id="mode"><span id="modeTxt">Timed</span><small>Mode</small></div>
      <div class="badge" id="timer"><span id="timeTxt">—</span><small>Timer</small></div>
      <div class="badge" id="scoreTop"><span id="scoreTopVal">0 / 0</span><small>Score</small></div>
    </div>
    <div class="top-actions">
      <button class="fsBtn" id="fsBtn" title="Toggle full screen">⛶ Full screen</button>
    </div>
  </div>

  <!-- Global how-to hint -->
  <div class="card" id="globalHint">
    <details>
      <summary>Quick refresher (click to expand)</summary>
      <div class="hint">
        <ul>
          <li><strong>Use π = 3.142 for all circular parts.</strong></li>
          <li><strong>Rectangle:</strong> \(A = L \times W\)</li>
          <li><strong>Triangle:</strong> \(A = \tfrac{1}{2} b h\)</li>
          <li><strong>Circle:</strong> \(A = \pi r^2\); <strong>Semicircle:</strong> \(A = \tfrac{1}{2}\pi r^2\)</li>
          <li><strong>Annulus (ring):</strong> \(A = \pi(R_o^2 - R_i^2)\)</li>
          <li><strong>Compound shapes:</strong> Add component areas; subtract voids/holes.</li>
          <li><strong>Conversions:</strong> \(1\,\text{m}=100\,\text{cm}=1000\,\text{mm}\). Areas: \(1\,\text{m}^2=10{,}000\,\text{cm}^2=1{,}000{,}000\,\text{mm}^2\).</li>
          <li><strong>Round every final answer to 2 dp.</strong></li>
        </ul>
      </div>
    </details>
  </div>

  <!-- Question card -->
  <div class="card" id="qCard" style="display:none">
    <div class="titleRow">
      <div>
        <div class="qTitle" id="qTitle">Question</div>
        <div class="qMeta" id="qMeta">Use the given dimensions (and <strong>π = 3.142</strong> where needed). Answer to <strong>2 dp</strong>, then click <strong>Check</strong>.</div>
      </div>
      <div class="qMeta" id="progress">Question 1</div>
    </div>

    <div class="statement" id="statement"></div>

    <details id="hintBox">
      <summary>Hint / Formula (click to expand)</summary>
      <div class="hint" id="hintHtml"></div>
    </details>

    <div class="io">
      <div class="row">
        <label>Result</label>
        <input class="num" id="ansVal" type="text" inputmode="decimal" autocomplete="off" placeholder="e.g. 123.45">
        <span class="unit" id="unitOut"></span>
        <span class="marker" id="markAns"></span>
        <span class="feedback" id="fbAns"></span>
      </div>
    </div>

    <div class="controls">
      <button class="primary" id="checkBtn">Check</button>
      <button class="ghost" id="nextBtn" disabled>Next</button>
      <button class="secondary" id="newBtn">New questions</button>
    </div>
  </div>

  <!-- End summary -->
  <div id="endCard">
    <h3>Summary</h3>
    <p class="wellDone" id="endMsg"></p>
    <ul>
      <li><strong>Name:</strong> <span id="sumName"></span></li>
      <li><strong>Mode:</strong> <span id="sumMode"></span></li>
      <li><strong>Score:</strong> <span id="sumScore"></span></li>
      <li><strong>Time used:</strong> <span id="sumTime"></span></li>
    </ul>
    <div style="display:flex;gap:.6rem;justify-content:center;margin-top:.4rem">
      <button class="secondary" id="restartBtn">Restart</button>
    </div>
  </div>

  <!-- Start menu modal -->
  <div class="modal" id="startModal">
    <div class="panel">
      <header><h2>Start Worksheet</h2></header>
      <div class="content">
        <div class="field">
          <label for="nameInput"><strong>Your name</strong></label>
          <input id="nameInput" type="text" placeholder="Type your name…" autocomplete="name">
        </div>

        <div class="field">
          <label><strong>Mode</strong></label>
          <div class="choiceRow">
            <label class="pill"><input type="radio" name="mode" value="timed" checked>Timed</label>
            <label class="pill"><input type="radio" name="mode" value="target">Target</label>
          </div>
        </div>

        <div class="grid2">
          <div class="field" id="timedField" style="display:block">
            <label><strong>Time limit</strong></label>
            <div class="choiceRow">
              <label class="pill"><input type="radio" name="tlimit" value="600">10 minutes</label>
              <label class="pill"><input type="radio" name="tlimit" value="1200" checked>20 minutes</label>
              <label class="pill"><input type="radio" name="tlimit" value="1800">30 minutes</label>
              <label class="pill"><input type="radio" name="tlimit" value="0">Unlimited</label>
            </div>
          </div>

          <div class="field" id="targetField" style="display:none">
            <label for="targetInput"><strong>Target (correct answers to finish)</strong></label>
            <input id="targetInput" type="number" min="1" max="1000" step="1" value="10">
          </div>
        </div>

        <div class="grid2">
          <div class="field">
            <label for="qtyInput"><strong>Total questions (per set)</strong></label>
            <select id="qtyInput">
              <option value="8">8</option>
              <option value="10" selected>10</option>
              <option value="12">12</option>
              <option value="15">15</option>
            </select>
          </div>
          <div class="field">
            <label class="muted">Tip</label>
            <div class="muted">Use the exact π value given (\(3.142\)) for circles. Convert lengths before squaring for areas. Answer to <strong>2 dp</strong>.</div>
          </div>
        </div>
      </div>
      <footer>
        <span class="muted">You can generate a fresh random set any time.</span>
        <div>
          <button class="primary" id="startBtn">Start worksheet</button>
        </div>
      </footer>
    </div>
  </div>

  <div id="errBanner"></div>
  <noscript><div style="margin:1rem auto;max-width:980px;color:#b91c1c;background:#fee;border:2px solid #e11d48;padding:.6rem;border-radius:12px;font-weight:800">This worksheet needs JavaScript enabled.</div></noscript>

<script>
'use strict';

window.addEventListener('error', (e) => {
  const b = document.getElementById('errBanner');
  b.textContent = 'Error: ' + (e.message || 'Unknown script error');
  b.style.display = 'block';
});

window.addEventListener('DOMContentLoaded', () => {

  /* ========= Core helpers ========= */
  const rnd=(m,M)=>Math.floor(Math.random()*(M-m+1))+m;
  const pick=arr=>arr[Math.floor(Math.random()*arr.length)];
  const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));
  const rndf=(min,max,dp=2)=>+((Math.random()*(max-min)+min).toFixed(dp));

  const round2=x=>Math.round((+x + Number.EPSILON)*100)/100;
  const to2=x=>isFinite(x)?round2(x).toFixed(2):'—';
  const parseNum = (input) => {
    const raw = (typeof input === 'string' ? input : (input?.value ?? '')).toString().trim().replace(',','.');
    const x = parseFloat(raw);
    return isFinite(x)?x:NaN;
  };
  const eq2dp=(a,b)=>isFinite(a)&&isFinite(b)&&round2(a)===round2(b);
  const secsToMMSS=s=>{const m=Math.floor(s/60), ss=String(s%60).padStart(2,'0'); return `${m}:${ss}`;};

  /* ========= Unit helpers ========= */
  const unit = (u) => ({
    mm:'mm', cm:'cm', m:'m',
    mm2:'mm²', cm2:'cm²', m2:'m²'
  }[u]||u);

  /* ========= Drawing helpers (SVG) ========= */
  function figWrap(viewW, viewH, inner){
    const gradId = `g_${Math.random().toString(36).slice(2)}`; // stable per figure
    return `<svg class="fig" viewBox="0 0 ${viewW} ${viewH}" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="diagram">
      <defs>
        <linearGradient id="${gradId}" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#6a5cff" stop-opacity="0.20"/>
          <stop offset="100%" stop-color="#00c2ff" stop-opacity="0.25"/>
        </linearGradient>
        <style>
          .shape{fill:url(#${gradId});stroke:#2c3477;stroke-width:2}
          .dim{font:700 13px/1.1 Inter, system-ui; fill:#0f172a}
          .label{font:800 14px/1.1 Inter, system-ui; fill:#2c3477}
          .aux{stroke:#94a3b8;stroke-dasharray:4 3}
        </style>
      </defs>
      ${inner}
    </svg>`;
  }

  function svgRectLW(Ltxt,Wtxt){
    const w=320, h=180;
    const inner=`
      <rect x="40" y="30" width="240" height="120" rx="6" class="shape"/>
      <text x="160" y="24" text-anchor="middle" class="label">Rectangle</text>
      <line x1="40" y1="160" x2="280" y2="160" class="aux"/><text x="160" y="175" text-anchor="middle" class="dim">L = ${Ltxt}</text>
      <line x1="15" y1="30" x2="15" y2="150" class="aux"/><text x="15" y="95" text-anchor="middle" transform="rotate(-90,15,95)" class="dim">W = ${Wtxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgTriBH(bTxt,hTxt){
    const w=320,h=200;
    const inner=`
      <polygon points="40,160 280,160 80,40" class="shape"/>
      <text x="160" y="26" text-anchor="middle" class="label">Triangle</text>
      <line x1="40" y1="170" x2="280" y2="170" class="aux"/><text x="160" y="188" text-anchor="middle" class="dim">b = ${bTxt}</text>
      <line x1="80" y1="40" x2="80" y2="160" class="aux"/><text x="92" y="100" class="dim" transform="rotate(-90,92,100)">h = ${hTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgCircleD(dTxt){
    const w=300,h=210, cx=150, cy=100, r=60;
    const inner=`
      <circle cx="${cx}" cy="${cy}" r="${r}" class="shape"/>
      <text x="${cx}" y="24" text-anchor="middle" class="label">Circle (π = 3.142)</text>
      <line x1="${cx-r}" y1="${cy}" x2="${cx+r}" y2="${cy}" class="aux"/>
      <text x="${cx}" y="${cy+18}" text-anchor="middle" class="dim">d = ${dTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgSemiCircleD(dTxt){
    const w=320,h=200, cx=160, cy=120, r=90;
    const inner=`
      <path d="M ${cx-r} ${cy} A ${r} ${r} 0 0 1 ${cx+r} ${cy} L ${cx-r} ${cy} Z" class="shape"/>
      <text x="${cx}" y="24" text-anchor="middle" class="label">Semicircle (π = 3.142)</text>
      <line x1="${cx-r}" y1="${cy}" x2="${cx+r}" y2="${cy}" class="aux"/>
      <text x="${cx}" y="${cy+18}" text-anchor="middle" class="dim">d = ${dTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgAnnulus(DoutTxt,DinTxt){
    const w=320,h=220,cx=160,cy=110,R=80,r=50;
    const inner=`
      <circle cx="${cx}" cy="${cy}" r="${R}" class="shape"/>
      <circle cx="${cx}" cy="${cy}" r="${r}" fill="#fff" stroke="#2c3477" stroke-width="2"/>
      <text x="${cx}" y="24" text-anchor="middle" class="label">Annulus (π = 3.142)</text>
      <line x1="${cx-R}" y1="${cy}" x2="${cx+R}" y2="${cy}" class="aux"/>
      <line x1="${cx-r}" y1="${cy+18}" x2="${cx+r}" y2="${cy+18}" class="aux"/>
      <text x="${cx}" y="${cy-10}" text-anchor="middle" class="dim">Dₒ = ${DoutTxt}</text>
      <text x="${cx}" y="${cy+40}" text-anchor="middle" class="dim">Dᵢ = ${DinTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgRectWithHole(Ltxt,Wtxt,dTxt){
    const w=340,h=220;
    const inner=`
      <rect x="40" y="40" width="260" height="140" rx="6" class="shape"/>
      <circle cx="170" cy="110" r="40" fill="#fff" stroke="#2c3477" stroke-width="2"/>
      <text x="170" y="26" text-anchor="middle" class="label">Rectangular slab with circular opening (π = 3.142)</text>
      <line x1="40" y1="190" x2="300" y2="190" class="aux"/><text x="170" y="206" text-anchor="middle" class="dim">L = ${Ltxt}</text>
      <line x1="20" y1="40" x2="20" y2="180" class="aux"/><text x="20" y="112" transform="rotate(-90,20,112)" text-anchor="middle" class="dim">W = ${Wtxt}</text>
      <line x1="130" y1="110" x2="210" y2="110" class="aux"/><text x="170" y="126" text-anchor="middle" class="dim">d = ${dTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgRectWithSemiEnd(Wtxt,Ltxt){
    const w=360,h=230;
    const inner=`
      <rect x="60" y="60" width="200" height="110" rx="6" class="shape"/>
      <path d="M 260 60 A 55 55 0 0 1 260 170 L 260 60 Z" class="shape"/>
      <text x="180" y="30" text-anchor="middle" class="label">Bay with semicircular end (π = 3.142)</text>
      <line x1="60" y1="180" x2="260" y2="180" class="aux"/><text x="160" y="196" text-anchor="middle" class="dim">Rect length = ${Ltxt}</text>
      <line x1="40" y1="60" x2="40" y2="170" class="aux"/><text x="40" y="116" transform="rotate(-90,40,116)" text-anchor="middle" class="dim">Width = ${Wtxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  function svgLShape(LoTxt,WoTxt,liTxt,wiTxt){
    const w=360,h=230;
    const inner=`
      <rect x="50" y="50" width="220" height="130" rx="6" class="shape"/>
      <rect x="180" y="90" width="80" height="60" fill="#fff" stroke="#2c3477" stroke-width="2"/>
      <text x="180" y="26" text-anchor="middle" class="label">L-shaped pad (rect − rect)</text>
      <text x="160" y="196" text-anchor="middle" class="dim">Outer: ${LoTxt} × ${WoTxt}</text>
      <text x="220" y="86" text-anchor="middle" class="dim">Notch: ${liTxt} × ${wiTxt}</text>
    `;
    return figWrap(w,h,inner);
  }

  /* ========= Constants ========= */
  const PIQ = 3.142; // mandated π for all circle calculations

  /* ========= Question generators ========= */
  function qRect_Slab_m(){
    const L = rndf(3.2, 15.0, 2); // m
    const W = rndf(2.0, 8.0, 2);  // m
    const A = L*W;                // m²
    return {
      title:'Plant plinth – rectangular slab area (m × m → m²)',
      statementHTML:`
        A generator plinth is a rectangular slab measuring <strong>${L.toFixed(2)} m</strong> by <strong>${W.toFixed(2)} m</strong>.
        Find the slab area in m².
        ${svgRectLW(`${L.toFixed(2)} m`, `${W.toFixed(2)} m`)}
      `,
      hintHTML:`Rectangle area: \\(A=L\\times W\\). Work in metres, then round to 2 dp.`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qRect_Slab_mm_to_m2(){
    const Lmm = rnd(1800, 9000);  // mm
    const Wmm = rnd(900, 4200);   // mm
    const Lm = Lmm/1000, Wm = Wmm/1000;
    const A = Lm*Wm; // m²
    return {
      title:'Equipment pad – drawing in mm, area in m²',
      statementHTML:`
        A pad is set out at <strong>${Lmm} mm</strong> by <strong>${Wmm} mm</strong>. Compute the area in m².
        ${svgRectLW(`${Lmm} mm`, `${Wmm} mm`)}
      `,
      hintHTML:`Convert mm→m by \\(/1000\\) <em>before</em> multiplying. \\(A=(L/1000)\\times(W/1000)\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qRectYard_cm2(){
    const Lcm = rnd(120, 360);
    const Wcm = rnd(80, 320);
    const A = Lcm*Wcm; // cm²
    return {
      title:'Detail sketch – rectangular yard (cm → cm²)',
      statementHTML:`
        On a detail sketch, a rectangular yard is <strong>${Lcm} cm</strong> by <strong>${Wcm} cm</strong>. Find the area in cm².
        ${svgRectLW(`${Lcm} cm`, `${Wcm} cm`)}
      `,
      hintHTML:`\\(A=L\\times W\\) directly in cm².`,
      unitOut: unit('cm2'),
      check:()=>({ val: A })
    };
  }

  function qLPad_RectMinusRect_m(){
    const Lo = rndf(5.0, 12.0, 2);
    const Wo = rndf(3.0, 8.0, 2);
    const li = rndf(1.0, Math.max(1.0, Lo - 2.0), 2);
    const wi = rndf(1.0, Math.max(1.0, Wo - 1.0), 2);
    const A = Lo*Wo - li*wi;
    return {
      title:'L-shaped pad (rectangle minus rectangle, m → m²)',
      statementHTML:`
        A concrete pad is L‑shaped: start with a rectangle <strong>${Lo.toFixed(2)} m × ${Wo.toFixed(2)} m</strong> and remove a rectangular notch <strong>${li.toFixed(2)} m × ${wi.toFixed(2)} m</strong>.
        Find the net area in m².
        ${svgLShape(`${Lo.toFixed(2)} m`, `${Wo.toFixed(2)} m`, `${li.toFixed(2)} m`, `${wi.toFixed(2)} m`)}
      `,
      hintHTML:`Net area = outer rectangle − inner rectangle. \\(A=L_oW_o - l_iw_i\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qTri_Gable_m(){
    const b = rndf(3.0, 14.0, 2);  // m
    const h = rndf(1.2, 6.0, 2);   // m
    const A = 0.5*b*h;
    return {
      title:'Triangular gable infill area (m × m → m²)',
      statementHTML:`
        A triangular gable end needs sheathing. Base <strong>${b.toFixed(2)} m</strong>, height <strong>${h.toFixed(2)} m</strong>.
        Find the area in m².
        ${svgTriBH(`${b.toFixed(2)} m`, `${h.toFixed(2)} m`)}
      `,
      hintHTML:`Triangle area: \\(A=\\tfrac{1}{2}bh\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qTri_Vergewedge_cm_to_m2(){
    const bcm = rnd(120, 420); // cm
    const hcm = rnd(60, 240);  // cm
    const bm = bcm/100, hm = hcm/100;
    const A = 0.5*bm*hm; // m²
    return {
      title:'Verge triangular wedge (cm → m²)',
      statementHTML:`
        A roadside verge is triangular: base <strong>${bcm} cm</strong>, height <strong>${hcm} cm</strong>.
        Compute its area in m².
        ${svgTriBH(`${bcm} cm`, `${hcm} cm`)}
      `,
      hintHTML:`Convert cm→m by \\(/100\\) then apply \\(A=\\tfrac12 bh\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qCircle_Manhole_cm(){
    const dcm = rnd(60, 120);          // diameter in cm
    const rcm = dcm/2;
    const A_cm2 = PIQ*(rcm*rcm);       // cm²
    const A = A_cm2/10000;             // m²
    return {
      title:'Circular manhole cover area (use π = 3.142)',
      statementHTML:`
        A circular manhole cover has diameter <strong>${dcm} cm</strong>. <strong>Use π = 3.142.</strong>
        Find the area in m².
        ${svgCircleD(`${dcm} cm`)}
      `,
      hintHTML:`\\(A=\\pi r^2\\) with \\(\\pi=3.142\\). Convert cm²→m² by \\(/10{,}000\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qCircle_Column_mm2(){
    const dmm = rnd(300, 1600);
    const rmm = dmm/2;
    const A_mm2 = PIQ*(rmm*rmm); // mm²
    return {
      title:'Round column cross‑section area (mm → mm²)',
      statementHTML:`
        A reinforced concrete column is circular with diameter <strong>${dmm} mm</strong>. <strong>Use π = 3.142.</strong>
        Find its cross‑sectional area in mm².
        ${svgCircleD(`${dmm} mm`)}
      `,
      hintHTML:`\\(A=\\pi r^2\\) with \\(r=\\tfrac{d}{2}\\) in mm and \\(\\pi=3.142\\). Answer in mm².`,
      unitOut: unit('mm2'),
      check:()=>({ val: A_mm2 })
    };
  }

  function qSemi_Culvert_m(){
    const d = rndf(1.2, 4.0, 2);  // m
    const r = d/2;
    const A = 0.5*PIQ*(r*r);     // m²
    return {
      title:'Headwall semicircular opening (m → m²)',
      statementHTML:`
        A culvert headwall has a semicircular arch of diameter <strong>${d.toFixed(2)} m</strong>. <strong>Use π = 3.142.</strong>
        Find the area of the opening (m²).
        ${svgSemiCircleD(`${d.toFixed(2)} m`)}
      `,
      hintHTML:`Semicircle: \\(A=\\tfrac12\\pi r^2\\), \\(\\pi=3.142\\), radius \\(r=\\tfrac{d}{2}\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qAnnulus_Pipe_mm_to_m2(){
    const Do = rnd(800, 2400);       // mm
    const t  = rnd(60, 180);         // mm wall thickness
    const Di = Do - 2*t;             // mm
    const Ro = Do/2, Ri = Di/2;
    const A_mm2 = PIQ*(Ro*Ro - Ri*Ri);
    const A = A_mm2/1e6;             // m²
    return {
      title:'Steel pipe wall cross‑section (annulus, mm → m²)',
      statementHTML:`
        A circular pipe has outside diameter <strong>${Do} mm</strong> and wall thickness <strong>${t} mm</strong>.
        <strong>Use π = 3.142.</strong> Find the cross‑sectional area of steel (m²).
        ${svgAnnulus(`${Do} mm`, `${Di} mm`)}
      `,
      hintHTML:`Annulus: \\(A=\\pi(R_o^2 - R_i^2)\\) with \\(\\pi=3.142\\). Convert mm²→m² by \\(/1{,}000{,}000\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qRectWithHole_Slab_m_cm(){
    const Lm = rndf(4.0, 12.0, 2);
    const Wm = rndf(2.5, 7.0, 2);
    const dcm = rnd(20, 90);
    const r = (dcm/100)/2;
    const A = Lm*Wm - PIQ*(r*r); // m²
    return {
      title:'Service slab with circular duct opening (m & cm → m²)',
      statementHTML:`
        A rectangular slab is <strong>${Lm.toFixed(2)} m</strong> by <strong>${Wm.toFixed(2)} m</strong> with a circular service duct opening of diameter <strong>${dcm} cm</strong>.
        <strong>Use π = 3.142.</strong> Find the net concrete area in m².
        ${svgRectWithHole(`${Lm.toFixed(2)} m`, `${Wm.toFixed(2)} m`, `${dcm} cm`)}
      `,
      hintHTML:`Net area = rectangle − circle. \\(A=L\\cdot W - \\pi (\\tfrac{d}{2})^2\\) using \\(d=${dcm}\\,\\text{cm}=${(dcm/100).toFixed(2)}\\,\\text{m}\\) and \\(\\pi=3.142\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  function qRectWithSemiEnd_Bay_m(){
    const W = rndf(2.0, 6.0, 2);  // m width = diameter of semicircle
    const L = rndf(3.0, 15.0, 2); // m rectangular length
    const r = W/2;
    const A = L*W + 0.5*PIQ*(r*r); // m²
    return {
      title:'Parking bay with semicircular end (m → m²)',
      statementHTML:`
        A lay‑by is a rectangle of length <strong>${L.toFixed(2)} m</strong> and width <strong>${W.toFixed(2)} m</strong> with a semicircular end of radius <strong>${(r).toFixed(2)} m</strong> (diameter = width).
        <strong>Use π = 3.142.</strong> Find the total area in m².
        ${svgRectWithSemiEnd(`${W.toFixed(2)} m`, `${L.toFixed(2)} m`)}
      `,
      hintHTML:`Total = rectangle + semicircle. \\(A=L\\cdot W + \\tfrac{1}{2}\\pi r^2\\) with \\(r=\\tfrac{W}{2}\\), \\(\\pi=3.142\\).`,
      unitOut: unit('m2'),
      check:()=>({ val: A })
    };
  }

  /* ========= SINGLE pool of generators ========= */
  const GENERATORS = [
    // Rectangles
    qRect_Slab_m,
    qRect_Slab_mm_to_m2,
    qRectYard_cm2,
    qLPad_RectMinusRect_m,
    // Triangles
    qTri_Gable_m,
    qTri_Vergewedge_cm_to_m2,
    // Circles / semicircles / annuli
    qCircle_Manhole_cm,
    qCircle_Column_mm2,
    qSemi_Culvert_m,
    qAnnulus_Pipe_mm_to_m2,
    // Compound
    qRectWithHole_Slab_m_cm,
    qRectWithSemiEnd_Bay_m
  ];

  /* ========= State ========= */
  let QUESTIONS=[], BATCH=10, idx=0, score=0;
  let nameStr='Student', mode='timed', timeLeft=0, timerId=null, target=0, correctSoFar=0, unlimited=false;
  let currentQ=null;

  /* ========= Elements ========= */
  const el = id=>document.getElementById(id);
  const $startModal=el('startModal');
  const $qCard=el('qCard');
  const $endCard=el('endCard');
  const $qTitle=el('qTitle'), $statement=el('statement'), $hintHtml=el('hintHtml');
  const $progress=el('progress');
  const $ansVal=el('ansVal'), $unitOut=el('unitOut'), $markAns=el('markAns'), $fbAns=el('fbAns');
  const $checkBtn=el('checkBtn'), $nextBtn=el('nextBtn'), $newBtn=el('newBtn'), $fsBtn=el('fsBtn');
  const $sumName=el('sumName'), $sumMode=el('sumMode'), $sumScore=el('sumScore'), $sumTime=el('sumTime');
  const $scoreTopVal=el('scoreTopVal'), $modeTxt=el('modeTxt'), $timeTxt=el('timeTxt');

  /* ========= Build a set ========= */
  function buildSet(n){
    const gens=[...GENERATORS];
    const qs=[];
    for(let i=0;i<n;i++){
      const g = gens.length ? gens.splice(rnd(0,gens.length-1),1)[0] : pick(GENERATORS);
      qs.push(g());
    }
    return qs;
  }

  /* ========= Top bar / timer ========= */
  function updateTop(){
    el('whoName').textContent = nameStr || 'Student';
    $modeTxt.textContent = mode==='timed' ? 'Timed' : 'Target';
    $scoreTopVal.textContent = `${score} / ${idx}`;
    $timeTxt.textContent = (mode==='timed' && !unlimited) ? secsToMMSS(timeLeft) : '—';
  }
  function startTimer(){
    if(mode!=='timed' || unlimited) return;
    clearInterval(timerId);
    timerId = setInterval(()=>{
      timeLeft = Math.max(0, timeLeft-1);
      $timeTxt.textContent = secsToMMSS(timeLeft);
      if(timeLeft===0){
        clearInterval(timerId);
        finish('Time’s up!');
      }
    },1000);
  }

  /* ========= Start / Finish ========= */
  function startWorksheet(){
    BATCH = parseInt(el('qtyInput').value,10);
    QUESTIONS = buildSet(BATCH);
    idx=0; score=0; correctSoFar=0;
    $endCard.style.display='none';
    $qCard.style.display='block';
    el('globalHint').style.display='block';
    renderQ();
    updateTop();
    if(window.MathJax && window.MathJax.typeset){ MathJax.typeset(); }
    if(mode==='timed'){ startTimer(); }
  }
  function finish(message='Well done!'){
    clearInterval(timerId);
    $qCard.style.display='none';
    el('globalHint').style.display='none';
    $endCard.style.display='block';
    el('endMsg').textContent = message;
    $sumName.textContent = nameStr || 'Student';
    $sumMode.textContent = ($modeTxt.textContent);
    $sumScore.textContent = `${score} / ${idx}`;
    const tlimitRaw = parseInt(document.querySelector('input[name="tlimit"]:checked')?.value||'0',10);
    const setTime = (mode==='timed' && !unlimited) ? tlimitRaw : 0;
    const usedSecs = (mode==='timed' && !unlimited) ? (setTime - timeLeft) : 0;
    $sumTime.textContent = (mode==='timed' && !unlimited) ? secsToMMSS(usedSecs) : '—';
  }

  /* ========= Render ========= */
  function clearFeedback(){
    $markAns.textContent=''; $markAns.className='marker'; $fbAns.textContent='';
  }
  function progressText(){
    return (mode==='timed') ? `Question ${idx+1}` : `Question ${idx+1} · Target ${correctSoFar}/${target}`;
  }
  function renderQ(){
    const local = idx % QUESTIONS.length;
    currentQ = QUESTIONS[local];
    $progress.textContent = progressText();
    $qTitle.textContent = currentQ.title;
    $statement.innerHTML = currentQ.statementHTML;
    $hintHtml.innerHTML = currentQ.hintHTML;
    $unitOut.textContent = currentQ.unitOut;
    $ansVal.value='';
    $ansVal.disabled=false;
    clearFeedback();
    $nextBtn.disabled = true;
    if(window.MathJax && window.MathJax.typeset){ MathJax.typeset(); }
  }

  /* ========= Check/Score ========= */
  function checkCurrent(){
    const { val } = currentQ.check();
    const expected = round2(val);
    const expectedStr = to2(expected);
    const stu = parseNum($ansVal);

    if(isFinite(stu)) $ansVal.value = to2(stu);

    let ok=false;
    if(isFinite(stu) && eq2dp(stu, expected)){
      $markAns.textContent='✓'; $markAns.className='marker ok'; $fbAns.textContent='';
      ok=true;
    }else if(!isNaN(stu)){
      $markAns.textContent='✗'; $markAns.className='marker no';
      $fbAns.innerHTML = `Ans: <span class="ans">${expectedStr} ${currentQ.unitOut}</span>`;
    }else{
      $markAns.textContent='✗'; $markAns.className='marker no';
      $fbAns.textContent = 'Please enter a number (e.g. 123.45).';
    }

    if(ok){ score++; correctSoFar++; }
    $scoreTopVal.textContent = `${score} / ${idx+1}`;

    $ansVal.disabled=true;
    $nextBtn.disabled=false;

    if(mode==='target' && correctSoFar>=target){
      finish('Target achieved!');
    }
  }

  function nextQ(){
    idx++;
    if(idx % QUESTIONS.length === 0){
      QUESTIONS = buildSet(BATCH); // refresh questions for variety
    }
    renderQ();
    updateTop();
  }

  /* ========= Events ========= */
  document.querySelectorAll('input.num').forEach(inp=>{
    inp.addEventListener('blur', ()=>{
      const x = parseNum(inp);
      if(isFinite(x)) inp.value = to2(x);
    });
  });
  $checkBtn.addEventListener('click', checkCurrent);
  $nextBtn.addEventListener('click', nextQ);
  $newBtn.addEventListener('click', ()=>{ el('startModal').style.display='flex'; });

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if(e.key==='Enter' && !$nextBtn.disabled){ nextQ(); }
    else if(e.key==='Enter' && $nextBtn.disabled){ checkCurrent(); }
  });

  /* ========= Start modal logic ========= */
  function updateModeFields(){
    const modeEl = document.querySelector('input[name="mode"]:checked');
    const modeVal = modeEl ? modeEl.value : 'timed';
    el('timedField').style.display = (modeVal==='timed') ? '' : 'none';
    el('targetField').style.display = (modeVal==='target') ? '' : 'none';
  }
  document.querySelectorAll('input[name="mode"]').forEach(r=>r.addEventListener('change', updateModeFields));

  el('startBtn').addEventListener('click', ()=>{
    nameStr = el('nameInput').value.trim() || 'Student';
    const picked = document.querySelector('input[name="mode"]:checked');
    mode = picked ? picked.value : 'timed';
    unlimited = false;
    if(mode==='timed'){
      const tSel = parseInt(document.querySelector('input[name="tlimit"]:checked')?.value||'1200',10);
      unlimited = (tSel===0);
      timeLeft = unlimited ? 0 : tSel;
    } else {
      timeLeft = 0;
    }
    if(mode==='target'){
      target = clamp(parseInt(el('targetInput').value,10)||10,1,1000000);
    } else { target = 0; }
    el('startModal').style.display='none';
    $modeTxt.textContent = mode==='timed' ? 'Timed' : 'Target';
    if(mode==='timed' && unlimited){ $timeTxt.textContent='—'; }
    startWorksheet();
  });

  el('restartBtn').addEventListener('click', ()=>{ el('startModal').style.display='flex'; });
  updateModeFields();

  /* ========= Fullscreen toggle ========= */
  $fsBtn.addEventListener('click', ()=>{
    if(!document.fullscreenElement){
      document.documentElement.requestFullscreen?.();
    }else{
      document.exitFullscreen?.();
    }
  });
  document.addEventListener('fullscreenchange', ()=>{
    $fsBtn.textContent = document.fullscreenElement ? '✕ Exit full screen' : '⛶ Full screen';
  });

  /* ========= Initial ========= */
  el('startModal').style.display='flex';
});
</script>
</body>
</html>
